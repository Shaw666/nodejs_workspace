"use strict";var util=require("util");var EventEmitter=require("events").EventEmitter;var LF=String.fromCharCode(10);var CR=String.fromCharCode(13);var ACK=String.fromCharCode(6);var NAK=String.fromCharCode(21);var IDLE_TIME=300;function Session(server,daemon,sessionId){this.server=server;this.daemon=daemon;this.sessionId=sessionId;this.uptime=new Date;this.runtime={profile:{tid:null,brand:null,model:null,ver:null,sn:null},areas:{"01":{acct:null,stat:"na"}},zones:{},flags:{"low-battery":null,"ac-fail":null,"line-fail":null,gprs:null},geo:{lon:null,lat:null},level:1e4}}util.inherits(Session,EventEmitter);Session.prototype.ip=function(){return""};Session.prototype.level=function(){return this.runtime.level};Session.prototype.tid=function(){var result=this.runtime.profile.tid;if(!result){result=""}return result};Session.prototype.sn=function(){var sn=this.runtime.profile.sn;if(sn){return sn}var tid=this.runtime.profile.tid;if(tid){return tid}return null};Session.prototype.model=function(){var model=this.runtime.profile.model;if(model){return model}else{return"n/a"}};Session.prototype.acct=function(){var acct=this.runtime.areas["01"].acct;if(acct!==null){acct=acct.toString(16).toUpperCase();while(acct.length<4){acct="0"+acct}var prefix=this.daemon.prefix();if(prefix){acct=prefix+acct}acct=acct.substr(-8)}return acct};Session.prototype.send_cmd=function(cmd){this.log("[error] virtual method called: Session.send_cmd",cmd)};Session.prototype.log=function(){var msg="";for(var i=0;i<arguments.length;i++){msg=msg+arguments[i]+" "}msg=msg.replace(/[\r]/g,"<CR>");msg=msg.replace(/[\n]/g,"<LF>");msg="["+this.sessionId+"]["+this.acct()+"]"+msg;this.daemon.log(msg)};module.exports=Session;